# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

service: fetch-motions

app: motioner
tenant: markushont

plugins:
  - serverless-offline

provider:
  name: aws
  runtime: nodejs8.10
  timeout: 300
  profile: wdip-test
  stage: dev
  region: eu-west-1
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: "arn:aws:dynamodb:eu-west-1:512130172746:table/motion-request-log"
    - Effect: "Allow"
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: "arn:aws:dynamodb:eu-west-1:512130172746:table/motions"

  environment:
    MOTION_REQUEST_LOG_TABLE: "motion-request-log"
    MOTION_TABLE: "motions"
    DATE_ZERO: "2000-01-01"
    DB_ITEM_MAX_SIZE: 300000 # Dynamodb max item size 400 kB

functions:
  fetchMotions:
    handler: handler.fetchMotions
    events:
      # Every Sunday at 00:00, see https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions
      - schedule:
          rate: cron(0 0 ? * SUN *)
          enabled: false
      - http:
          path: fetch-motions
          method: get
      - http:
          path: fetch-motions
          method: post
